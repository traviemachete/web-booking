<script>
  /* ========================================
   MEETING ROOM BOOKING SYSTEM - JavaScript
   ======================================== */

// Global variables
let calendar = null;
let currentView = 'calendar';
let isLoading = false;

/* ========== CALENDAR MANAGEMENT ========== */

function renderCalendar(events = []) {
  const calendarEl = document.getElementById('calendar');
  if (!calendarEl) {
    console.warn('Calendar element not found');
    return;
  }

  // Destroy existing calendar if it exists
  if (calendar) {
    calendar.destroy();
    calendar = null;
  }

  // Create new calendar instance
  calendar = new FullCalendar.Calendar(calendarEl, {
    // Basic configuration
    initialView: 'dayGridMonth',
    height: '100%',
    locale: 'th',
    firstDay: 0, // Sunday
    
     /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏™‡∏°‡∏≠ */
    eventTimeFormat: {
      hour:   '2-digit',
      minute: '2-digit',
      hour12: false      // 24‚ÄØ‡∏ä‡∏°.  ‚Üí  ‚Äú10:00‚Äù
    },
    // Header toolbar configuration
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
    },
    
    // Button text localization
    buttonText: {
      today: '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
      month: '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
      week: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
      day: '‡∏ß‡∏±‡∏ô',
      list: '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'
    },
    
    // Custom buttons
    customButtons: {
      refreshBtn: {
        text: 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä',
        click: function() {
          refreshCalendarData();
        }
      }
    },
    
    // Events configuration
    events: events || [],
    eventDisplay: 'block',
    dayMaxEvents: 3,
    moreLinkClick: 'popover',
    
    // Event interactions
    eventClick: function(info) {
      showEventDetails(info.event);
    },
    
    dateClick: function(info) {
      // Quick booking: pre-fill form with selected date
      const selectedDate = info.dateStr;
      document.getElementById('date').value = selectedDate;
      loadView('form');
    },
    
    // Event styling
    eventDidMount: function(info) {
      // Add tooltip or additional styling
      info.el.setAttribute('title', `${info.event.title}\n‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î`);
    },
    
    // Loading states
    loading: function(isLoading) {
      toggleLoadingState(isLoading);
    },
    
    // View change handling
    datesSet: function(info) {
      // Update view state when calendar view changes
      currentView = info.view.type;
    }
  });

  // Render the calendar
  calendar.render();
  
  console.log(`Calendar rendered with ${events.length} events`);
}

function showEventDetails(event) {
  const props = event.extendedProps || {};
  const startTime = event.start ? event.start.toLocaleTimeString('th-TH', {
    hour: '2-digit', 
    minute: '2-digit'
  }) : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
  const endTime = event.end ? event.end.toLocaleTimeString('th-TH', {
    hour: '2-digit', 
    minute: '2-digit'
  }) : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

  const eventDate = event.start ? event.start.toLocaleDateString('th-TH', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }) : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

  Swal.fire({
    title: 'üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
    html: `
      <div style="text-align: left; margin: 16px 0; line-height: 1.6;">
        <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
          <h4 style="margin: 0 0 8px 0; color: var(--text-color);">${event.title}</h4>
          <p style="margin: 4px 0; color: var(--text-secondary);"><strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${eventDate}</p>
          <p style="margin: 4px 0; color: var(--text-secondary);"><strong>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${startTime} - ${endTime}</p>
        </div>
        <p style="margin: 8px 0;"><strong>üë§ ‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á:</strong> ${props.booker || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
        <p style="margin: 8px 0;"><strong>üè¢ ‡∏ù‡πà‡∏≤‡∏¢:</strong> ${props.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
        <p style="margin: 8px 0;"><strong>üèõÔ∏è ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</strong> ${props.company || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
        <p style="margin: 8px 0;"><strong>üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:</strong> ${props.purpose || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
        <p style="margin: 8px 0;"><strong>üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> ${props.email || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
        <p style="margin: 8px 0;"><strong>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${props.status || '‡∏õ‡∏Å‡∏ï‡∏¥'}</p>
      </div>
    `,
    showCancelButton: true,
    confirmButtonText: '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç',
    cancelButtonText: '‚ùå ‡∏õ‡∏¥‡∏î',
    confirmButtonColor: '#1a73e8',
    cancelButtonColor: '#6c757d',
    width: '500px'
  }).then((result) => {
    if (result.isConfirmed) {
      // TODO: Implement edit functionality
      editBooking(event.id, props);
    }
  });
}

function refreshCalendarData() {
  if (typeof google !== 'undefined' && google.script && google.script.run) {
    toggleLoadingState(true);
    
    google.script.run
      .withSuccessHandler(function(events) {
        renderCalendar(events);
        toggleLoadingState(false);
        
        Swal.fire({
          icon: 'success',
          title: '‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
          text: `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ${events.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
          timer: 1500,
          showConfirmButton: false
        });
      })
      .withFailureHandler(function(error) {
        console.error('Calendar refresh failed:', error);
        toggleLoadingState(false);
        
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
        });
      })
      .listEvents();
  }
}

/* ========== FORM MANAGEMENT ========== */

function handleSubmit(event) {
  event.preventDefault();
  
  const form = event.target;
  const submitBtn = form.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  // Disable submit button and show loading
  submitBtn.disabled = true;
  submitBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

  // Collect form data
  const formData = new FormData(form);
  const bookingData = {
    date: formData.get('date'),
    start: formData.get('start'),
    end: formData.get('end'),
    name: formData.get('name'),
    department: formData.get('department'),
    company: formData.get('company'),
    purpose: formData.get('purpose'),
    email: formData.get('email')
  };

  // Client-side validation
  if (!validateBookingData(bookingData)) {
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
    return;
  }

  // Submit to server
  if (typeof google !== 'undefined' && google.script && google.script.run) {
    google.script.run
      .withSuccessHandler(function(result) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
        
        if (result.status === 'ok') {
          Swal.fire({
            icon: 'success',
            title: '‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ',
            text: '‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
            timer: 2000,
            showConfirmButton: false
          }).then(() => {
            form.reset();
            loadView('calendar', true);
          });
        }
      })
      .withFailureHandler(function(error) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
        
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ'
        });
      })
      .submitBooking(bookingData);
  } else {
    // Fallback for testing
    setTimeout(() => {
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
      
      Swal.fire({
        icon: 'info',
        title: '‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
        text: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script'
      });
    }, 1000);
  }
}

function validateBookingData(data) {
  // Check required fields
  if (!data.date || !data.start || !data.end || !data.name) {
    Swal.fire({
      icon: 'warning',
      title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
      text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'
    });
    return false;
  }

  // Validate time range
  if (data.start >= data.end) {
    Swal.fire({
      icon: 'warning',
      title: '‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
      text: '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î'
    });
    return false;
  }

  // Check if booking date is in the past
  const bookingDate = new Date(data.date);
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  if (bookingDate < today) {
    Swal.fire({
      icon: 'warning',
      title: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
      text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ'
    });
    return false;
  }

  // Validate email format if provided
  if (data.email && !isValidEmail(data.email)) {
    Swal.fire({
      icon: 'warning',
      title: '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
      text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
    });
    return false;
  }

  return true;
}

function isValidEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

/* ========== VIEW MANAGEMENT ========== */

function loadView(viewName, forceRefresh = false) {
  if (isLoading && !forceRefresh) return;
  
  const mainContent = document.getElementById('mainContent');
  if (!mainContent) return;

  // Update navigation active state
  setActiveNav(viewName);
  
  // View mapping
  const viewMap = {
    calendar: 'CalendarView',
    form: 'Form',
    list: 'TodayList',
    login: 'Login'
  };

  const templateName = viewMap[viewName] || 'CalendarView';
  
  if (typeof google !== 'undefined' && google.script && google.script.run) {
    isLoading = true;
    
    google.script.run
      .withSuccessHandler(function(html) {
        mainContent.innerHTML = html;
        isLoading = false;
        
        // Post-load actions based on view
        handleViewLoaded(viewName);
      })
      .withFailureHandler(function(error) {
        console.error('Failed to load view:', error);
        mainContent.innerHTML = `
          <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
            <h3>‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
            <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
            <button onclick="loadView('calendar')" style="margin-top: 16px; padding: 8px 16px; background: var(--google-blue); color: white; border: none; border-radius: 4px; cursor: pointer;">
              ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
          </div>
        `;
        isLoading = false;
      })
      .include(templateName);
  } else {
    // Fallback content for testing
    mainContent.innerHTML = getFallbackContent(viewName);
    handleViewLoaded(viewName);
  }
}

function handleViewLoaded(viewName) {
  switch (viewName) {
    case 'calendar':
      setTimeout(() => {
        if (typeof google !== 'undefined' && google.script && google.script.run) {
          google.script.run
            .withSuccessHandler(renderCalendar)
            .withFailureHandler(function(error) {
              console.error('Failed to load events:', error);
              renderCalendar([]); // Render empty calendar
            })
            .listEvents();
        } else {
          renderCalendar(getSampleEvents());
        }
      }, 100);
      break;
      
    case 'form':
      setupFormDefaults();
      break;
      
    case 'list':
      loadBookingList();
      break;
  }
}

function setupFormDefaults() {
  // Set default date to today
  const today = new Date().toISOString().split('T')[0];
  const dateInput = document.getElementById('date');
  if (dateInput) {
    dateInput.value = today;
    dateInput.setAttribute('min', today); // Prevent past dates
  }

  // Set default time range (9:00 AM - 10:00 AM)
  const startInput = document.getElementById('start');
  const endInput = document.getElementById('end');
  if (startInput && !startInput.value) {
    startInput.value = '09:00';
  }
  if (endInput && !endInput.value) {
    endInput.value = '10:00';
  }
}

function loadBookingList() {
  // TODO: Implement booking list functionality
  const listContainer = document.getElementById('booking-list');
  if (listContainer) {
    listContainer.innerHTML = `
      <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
        <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <p>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤</p>
      </div>
    `;
  }
}

/* ========== UTILITY FUNCTIONS ========== */

function toggleLoadingState(loading) {
  const calendarEl = document.getElementById('calendar');
  if (!calendarEl) return;
  
  if (loading) {
    calendarEl.style.opacity = '0.6';
    calendarEl.style.pointerEvents = 'none';
  } else {
    calendarEl.style.opacity = '1';
    calendarEl.style.pointerEvents = 'auto';
  }
}

function editBooking(eventId, eventData) {
  // TODO: Implement edit booking functionality
  Swal.fire({
    icon: 'info',
    title: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç',
    text: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤'
  });
}

function getFallbackContent(viewName) {
  const fallbackContents = {
    calendar: `
      <div class="calendar-container">
        <div class="calendar-header">
          <h4>üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h4>
        </div>
        <div id="calendar"></div>
      </div>
    `,
    form: `
      <div style="max-width: 600px; margin: 0 auto; background: var(--bg-color); padding: 32px; border-radius: 8px;">
        <h3 style="text-align: center; margin-bottom: 24px;">üìù ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h3>
        <p style="text-align: center; color: var(--text-secondary);">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°</p>
      </div>
    `,
    list: `
      <div style="max-width: 800px; margin: 0 auto; background: var(--bg-color); padding: 32px; border-radius: 8px;">
        <h3 style="text-align: center; margin-bottom: 24px;">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <p style="text-align: center; color: var(--text-secondary);">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>
      </div>
    `
  };
  
  return fallbackContents[viewName] || fallbackContents.calendar;
}

function getSampleEvents() {
  const today = new Date();
  return [
    {
      id: 'sample-1',
      title: '‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏° IT (‡∏™‡∏°‡∏ä‡∏≤‡∏¢)',
      start: new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1, 9, 0),
      end: new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1, 11, 0),
      backgroundColor: '#1a73e8',
      extendedProps: {
        booker: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
        department: '‡∏ù‡πà‡∏≤‡∏¢‡πÑ‡∏≠‡∏ó‡∏µ',
        company: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC',
        purpose: '‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
        email: 'somchai@abc.com'
      }
    },
    {
      id: 'sample-2',
      title: '‡∏≠‡∏ö‡∏£‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏∏‡∏î‡∏≤)',
      start: new Date(today.getFullYear(), today.getMonth(), today.getDate() + 2, 13, 0),
      end: new Date(today.getFullYear(), today.getMonth(), today.getDate() + 2, 16, 0),
      backgroundColor: '#34a853',
      extendedProps: {
        booker: '‡∏™‡∏∏‡∏î‡∏≤ ‡∏ô‡∏±‡∏Å‡∏≠‡∏ö‡∏£‡∏°',
        department: '‡∏ù‡πà‡∏≤‡∏¢ HR',
        company: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC',
        purpose: '‡∏≠‡∏ö‡∏£‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà',
        email: 'suda@abc.com'
      }
    }
  ];
}

// Funtion Auth
function ensureAuth(callback){
  google.script.run.withSuccessHandler(user => {
    if (user) {
      callback();
    } else {
      M.toast({html: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"});
      loadView('login');
    }
  }).getSessionUser();
}


/* ========== INITIALIZATION ========== */

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
  console.log('Meeting Room Booking System - JavaScript loaded');
  
  // Set up global error handling
  window.addEventListener('error', function(e) {
    console.error('Global error:', e.error);
  });
  
  // Initialize theme if not already done
  if (typeof initializeTheme === 'function') {
    initializeTheme();
  }
});

// Export functions for global access
window.renderCalendar = renderCalendar;
window.handleSubmit = handleSubmit;
window.loadView = loadView;
window.refreshCalendarData = refreshCalendarData;
</script>


<script>
function requireLogin(cb){
  google.script.run.withSuccessHandler(function(user){
    if(user){ cb(); }
    else{
      M.toast({html:'üîí ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'});
      loadView('login');
    }
  }).getSessionUser();
}
</script>
