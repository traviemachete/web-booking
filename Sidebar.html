<!-- Sidebar.html (Google Style, Connected to main layout) -->
<div class="sidebar">
  <h5>Meeting Room</h5>
  <div class="user-info" id="userInfo">
    <!-- Filled by renderUserBox() -->
  </div>
  <ul class="menu"></ul>
</div>

<script>
function renderUserBox(){
  google.script.run.withSuccessHandler(function(user){
    const userBox = document.getElementById('userInfo');
    const menu = document.querySelector('.menu');
    if(!userBox || !menu) return;

    // Clear
    userBox.innerHTML = '';
    menu.innerHTML = '';

    if(user){ // Logged in
      userBox.innerHTML = `
        <p style="text-align:center">ğŸ‘¤ <strong>${user.name}</strong></p>
        <div style="text-align:center">
          <button class="btn btn-primary" onclick="logout()">ğŸšª à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š</button>
        </div>
      `;
      menu.insertAdjacentHTML('beforeend',`
        <li><a href="#" onclick="loadView('calendar')">ğŸ“… à¸›à¸à¸´à¸—à¸´à¸™</a></li>
        <li><a href="#" onclick="ensureAuth(()=>loadView('form'))">ğŸ“ à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡</a></li>
        <li><a href="#" onclick="loadView('today')">ğŸ“Œ à¸£à¸²à¸¢à¸à¸²à¸£à¸§à¸±à¸™à¸™à¸µà¹‰</a></li>
        <li><a href="#" onclick="loadView('mybookings')">ğŸ“‹ à¸£à¸²à¸¢à¸à¸²à¸£à¸‚à¸­à¸‡à¸‰à¸±à¸™</a></li>
      `);
      if(user.role === 'admin'){
        menu.insertAdjacentHTML('beforeend',`
          <li><a href="#" onclick="loadView('admin')">ğŸ”§ à¸ˆà¸±à¸”à¸à¸²à¸£à¸£à¸°à¸šà¸š</a></li>
        `);
      }
    } else { // Guest
      userBox.innerHTML = `
        <p style="text-align:center"><strong>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</strong></p>
        <div style="text-align:center">
          <button class="btn btn-primary" onclick="loadView('login')">ğŸ”‘ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
        </div>
      `;
      menu.insertAdjacentHTML('beforeend',`
        <li><a href="#" onclick="loadView('calendar')">ğŸ“… à¸›à¸à¸´à¸—à¸´à¸™</a></li>
      `);
    }
  }).getSessionUser();
}

function logout(){
  google.script.run.withSuccessHandler(()=>{
    renderUserBox();
    loadView('calendar');
  }).logoutUser();
}

function ensureAuth(cb){
  google.script.run.withSuccessHandler(function(user){
    if(user){ cb(); }
    else {
      M.toast({ html:'à¸à¸£à¸¸à¸“à¸²à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸à¹ˆà¸­à¸™à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£' });
      loadView('login');
    }
  }).getSessionUser();
}

window.addEventListener('DOMContentLoaded', renderUserBox);
</script>
