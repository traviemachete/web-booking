
<!-- Sidebar.html (hardened version) -->
<div class="layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="user-info" id="userInfo">
      <!-- Filled by renderUserBox() -->
    </div>

    <ul class="menu"></ul>
  </aside>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">
    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
  </main>
</div>

<style>
  :root {
    --bg-color: #202124;
    --text-color: #e8eaed;
    --primary-color: #8ab4f8;
    --hover-color: #3c4043;
    --sidebar-bg: #202124;
    --sidebar-hover: #3c4043;
    --btn-login-bg: #8ab4f8;
    --btn-login-text: #202124;
    --radius: 8px;
  }
  .layout{display:flex;min-height:100vh;font-family:'Kanit',sans-serif;}
  .sidebar{width:250px;background:var(--sidebar-bg);color:var(--text-color);padding:1rem;border-right:1px solid #3c4043;}
  .user-info{text-align:center;margin-bottom:1.5rem;}
  .user-info p{margin:0 0 10px 0;}
  .btn{padding:6px 16px;border:none;border-radius:var(--radius);cursor:pointer;font-size:14px;transition:background .2s;}
  .btn-primary{background:var(--btn-login-bg);color:var(--btn-login-text);}
  .btn-primary:hover{background:#a4c6fa;}
  .menu{list-style:none;padding:0;margin:0;}
  .menu li{margin-bottom:10px;}
  .menu a{display:block;padding:10px 14px;border-radius:var(--radius);color:var(--text-color);text-decoration:none;transition:background .2s;}
  .menu a:hover{background:var(--hover-color);}
  .main-content{flex-grow:1;padding:20px;background:var(--bg-color);}
  @media(max-width:768px){
    .layout{flex-direction:column;}
    .sidebar{width:100%;display:flex;flex-direction:row;justify-content:space-around;align-items:center;padding:10px 20px;}
    .menu{display:flex;gap:10px;}
  }
</style>

<script>
function renderUserBox(){
  google.script.run.withSuccessHandler(function(user){
    const userBox=document.getElementById('userInfo');
    const menu=document.querySelector('.menu');
    if(!userBox||!menu) return;

    // reset
    userBox.innerHTML='';
    menu.innerHTML='';

    if(user){ // ------ Logged in ------
      userBox.innerHTML=`
        <p>üë§ <strong>${user.name}</strong></p>
        <button class="btn btn-primary" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      `;
      menu.insertAdjacentHTML('beforeend',`
        <li><a href="#" onclick="loadView('calendar')">üìÖ ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
        <li><a href="#" onclick="ensureAuth(()=>loadView('form'))">üìù ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</a></li>
        <li><a href="#" onclick="loadView('mybookings')">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a></li>
      `);
      if(user.role==='admin'){
        menu.insertAdjacentHTML('beforeend',`
          <li><a href="#" onclick="loadView('admin')">üîß ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</a></li>
        `);
      }
    } else { // ------ Guest ------
      userBox.innerHTML=`
        <p><strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</strong></p>
        <button class="btn btn-primary" onclick="loadView('login')">üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      `;
      menu.insertAdjacentHTML('beforeend',`
        <li><a href="#" onclick="loadView('calendar')">üìÖ ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
      `);
    }
  }).getSessionUser();
}

function logout(){
  google.script.run.withSuccessHandler(()=>{renderUserBox();loadView('calendar');}).logoutUser();
}

function ensureAuth(cb){
  google.script.run.withSuccessHandler(function(user){
    if(user){cb();}else{
      M.toast({html:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'});
      loadView('login');
    }
  }).getSessionUser();
}

window.addEventListener('DOMContentLoaded',renderUserBox);
</script>
