<!-- Register.html -->
<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
      <div class="auth-logo">
        <span class="logo-icon">üè¢</span>
        <h2 class="logo-text">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h2>
      </div>
      <h3 class="auth-title">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
      <p class="auth-subtitle">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p>
    </div>

    <form id="registerForm" class="auth-form">
      <div class="form-group">
        <label for="registerName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input type="text" id="registerName" name="name" class="form-input" required>
      </div>

      <div class="form-group">
        <label for="registerNickname">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
        <input type="text" id="registerNickname" name="nickname" class="form-input" required>
      </div>

      <div class="form-group">
        <label for="registerEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô)</label>
        <input type="email" id="registerEmail" name="email" class="form-input" required>
      </div>

      <div class="form-group">
        <label for="registerPassword">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
        <input type="password" id="registerPassword" name="password" class="form-input" required>
      </div>

      <div class="form-group">
        <label for="registerPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
        <input type="tel" id="registerPhone" name="phone" class="form-input" required>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
        <button type="button" class="btn btn-secondary" onclick="loadView('login')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
      </div>
    </form>
  </div>
</div>

<style>
  .auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: auto;
    overflow-y: auto;
    padding: 20px;
    background: var(--bg-secondary);
  }

  .auth-card {
    background: var(--bg-color);
    border-radius: 12px;
    box-shadow: var(--shadow-2);
    padding: 0;
    width: 100%;
    max-width: 420px;
    overflow: hidden;
  }

  .auth-header {
    padding: 32px 32px 24px 32px;
    text-align: center;
    background: var(--bg-color);
    border-bottom: 1px solid var(--border-color);
  }

  .auth-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-bottom: 24px;
  }

  .logo-icon {
    font-size: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--google-blue);
    border-radius: 50%;
    color: white;
  }

  .logo-text {
    font-size: 18px;
    font-weight: 500;
    color: var(--text-color);
    margin: 0;
  }

  .auth-title {
    font-size: 24px;
    font-weight: 400;
    color: var(--text-color);
    margin: 0 0 8px 0;
  }

  .auth-subtitle {
    font-size: 16px;
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.5;
  }

  .auth-form {
    padding: 32px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-color);
    margin-bottom: 8px;
  }

  .form-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    background: var(--bg-color);
    color: var(--text-color);
    font-size: 16px;
    font-family: inherit;
    transition: var(--transition);
    box-sizing: border-box;
  }

  .form-input:focus {
    outline: none;
    border-color: var(--google-blue);
    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
  }

  .form-input::placeholder {
    color: var(--text-secondary);
  }

  .form-help {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 4px;
    line-height: 1.4;
  }

  .form-input.error {
    border-color: #ea4335;
  }

  .form-input.success {
    border-color: #34a853;
  }

  .error-message {
    color: #ea4335;
    font-size: 12px;
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .auth-btn {
    width: 100%;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 24px;
  }

  .auth-btn.primary {
    background: var(--google-blue);
    color: white;
  }

  .auth-btn.primary:hover {
    background: var(--google-blue-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-2);
  }

  .auth-btn.primary:active {
    transform: translateY(0);
  }

  .auth-btn:disabled {
    background: var(--google-gray-400);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .auth-btn.loading {
    position: relative;
    color: transparent;
  }

  .auth-btn.loading::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .auth-footer {
    text-align: center;
    padding-top: 16px;
    border-top: 1px solid var(--border-color);
  }

  .auth-link-text {
    font-size: 14px;
    color: var(--text-secondary);
    margin: 0;
  }

  .auth-link {
    color: var(--google-blue);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
  }

  .auth-link:hover {
    text-decoration: underline;
  }

  /* Dark theme adjustments */
  [data-theme="dark"] .auth-btn.primary {
    background: #8ab4f8;
    color: var(--google-gray-900);
  }

  [data-theme="dark"] .auth-btn.primary:hover {
    background: #aecbfa;
  }

  [data-theme="dark"] .form-input:focus {
    border-color: #8ab4f8;
    box-shadow: 0 0 0 3px rgba(138, 180, 248, 0.1);
  }

  [data-theme="dark"] .auth-link {
    color: #8ab4f8;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .auth-container {
      padding: 16px;
      align-items: flex-start;
      padding-top: 40px;
    }

    .auth-card {
      max-width: 100%;
    }

    .auth-header {
      padding: 24px 24px 20px 24px;
    }

    .auth-form {
      padding: 24px;
    }

    .logo-text {
      font-size: 16px;
    }

    .auth-title {
      font-size: 20px;
    }

    .form-input {
      font-size: 16px;
      /* Prevent zoom on iOS */
    }
  }
</style>

<!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Register.html Script Section -->
<script>
  safeReady (function () {
  const form = document.getElementById('registerForm');
  if (!form) {
    console.error('‚ùå Register form not found');
    return;
  }

  const btn = form.querySelector('button[type="submit"]');

  form.addEventListener('submit', function (e) {
    e.preventDefault();
    
    console.log('üìù Register form submitted');

    // Clear previous errors
    clearErrors();

    // Get form data
    const name = document.getElementById("registerName").value.trim();
    const nickname = document.getElementById("registerNickname").value.trim();
    const email = document.getElementById("registerEmail").value.trim();
    const password = document.getElementById("registerPassword").value.trim();
    const phone = document.getElementById("registerPhone").value.trim();

    console.log('üìã Form data:', { name, nickname, email, phone, passwordLength: password.length });

    // Validate
    if (!name || name.length < 2) {
      showError('registerName', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)');
      return;
    }
    if (!nickname) {
      showError('registerNickname', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô');
      return;
    }
    if (!email || !isValidEmail(email)) {
      showError('registerEmail', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
      return;
    }
    if (!password || password.length < 4) {
      showError('registerPassword', '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
      return;
    }
    if (!phone) {
      showError('registerPhone', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå');
      return;
    }

    // Disable button and show loading
    btn.disabled = true;
    const originalText = btn.innerHTML;
    btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...';

    const userData = { 
      name, 
      nickname,
      email, 
      password,
      phone 
    };

    console.log('üöÄ Sending registration data:', userData);

    // Check if Google Apps Script is available
    if (typeof google !== 'undefined' && google.script && google.script.run) {
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('‚úÖ Registration successful:', result);
          
          btn.disabled = false;
          btn.innerHTML = originalText;
          
          if (typeof Swal !== 'undefined') {
            Swal.fire({
              icon: 'success',
              title: '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ',
              text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...',
              timer: 2000,
              showConfirmButton: false
            });
          } else {
            alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
          }
          
          // Reset form
          form.reset();
          
          // Redirect to login after delay
          setTimeout(() => {
            if (typeof loadView === 'function') {
              loadView('login');
            } else {
              console.log('‚úÖ Registration complete - redirect to login');
            }
          }, 2000);
        })
        .withFailureHandler(function(error) {
          console.error('‚ùå Registration failed:', error);
          
          btn.disabled = false;
          btn.innerHTML = originalText;
          
          if (typeof Swal !== 'undefined') {
            Swal.fire({
              icon: 'error',
              title: '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
              text: error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'
            });
          } else {
            alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'));
          }
        })
        .registerUser(userData);
    } else {
      // Fallback for testing without Google Apps Script
      console.warn('‚ö†Ô∏è Google Apps Script not available - testing mode');
      
      setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        
        if (typeof Swal !== 'undefined') {
          Swal.fire({
            icon: 'info',
            title: '‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
            text: '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á'
          });
        } else {
          alert('‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á');
        }
      }, 1000);
    }
  });

  // Focus first input
  const firstInput = document.getElementById('registerName');
  if (firstInput) {
    firstInput.focus();
  }
});

function showError(fieldId, message) {
  const field = document.getElementById(fieldId);
  if (field) {
    field.classList.add('error');
    
    // Remove existing error message
    const existingError = field.parentNode.querySelector('.error-message');
    if (existingError) existingError.remove();
    
    // Add new error message
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.innerHTML = `‚ö†Ô∏è ${message}`;
    field.parentNode.appendChild(errorDiv);
    
    // Focus the field with error
    field.focus();
  }
}

function clearErrors() {
  const errorFields = document.querySelectorAll('.form-input.error');
  errorFields.forEach(field => {
    field.classList.remove('error', 'success');
  });

  const errorMessages = document.querySelectorAll('.error-message');
  errorMessages.forEach(msg => msg.remove());
}

function isValidEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

// Debug function
function debugRegister() {
  console.log('üîß Debug register form');
  console.log('Google Apps Script available:', typeof google !== 'undefined' && google.script);
  console.log('Swal available:', typeof Swal !== 'undefined');
  console.log('loadView available:', typeof loadView !== 'undefined');
}

// Call debug on load
debugRegister();
</script>
